 <h1>Just Messenger</h1>

  <!-- Step 1: Gather User & Recipient IDs -->
  <div id="loginPane">
    <label>
      Your User ID: 
      <input id="userIdInput" placeholder="e.g. 1, 2 or 3" />
    </label>
    <label>
      Recipient ID: 
      <input id="recipientIdInput" placeholder="e.g. 1, 2 or 3" />
    </label>
    <button id="connectBtn">Connect</button>
  </div>

  <!-- Step 2: Chat UI (hidden until connected) -->
  <div id="chatPane" class="hidden">
    <div id="messages"></div>
    <input id="msgInput" placeholder="Type a message…" />
    <button id="sendBtn">Send</button>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@@microsoft/signalr@@latest/dist/browser/signalr.min.js"></script>
  <script>
    const API_BASE = "https://localhost:7136";
    let connection, userId, recipientId;

    document.getElementById("connectBtn").addEventListener("click", async () => {
      // Read and validate IDs
      userId = document.getElementById("userIdInput").value.trim();
      recipientId = document.getElementById("recipientIdInput").value.trim();
      if (!userId || !recipientId) {
        alert("Both User ID and Recipient ID are required");
        return;
      }

      // Build and start the SignalR connection
      connection = new signalR.HubConnectionBuilder()
        .withUrl(`${API_BASE}/messagesHub?userId=${encodeURIComponent(userId)}`)
        .withAutomaticReconnect()
        .build();

      // Handle incoming messages
      connection.on("ReceiveMessage", msg => {
        const div = document.createElement("div");
        div.textContent = `${msg.senderId}: ${msg.text}`;
        document.getElementById("messages").appendChild(div);
        document.getElementById("messages").scrollTop = 
          document.getElementById("messages").scrollHeight;
      });

      try {
        await connection.start();
        console.log("Connected as user", userId);
      } catch (err) {
        console.error(err);
        alert("Connection failed");
        return;
      }

      // Show chat UI
      document.getElementById("loginPane").classList.add("hidden");
      document.getElementById("chatPane").classList.remove("hidden");
    });

    // Send a message
    document.getElementById("sendBtn").addEventListener("click", async () => {
      const text = document.getElementById("msgInput").value.trim();
      if (!text) return;
      try {
        await fetch(`${API_BASE}/api/message/send`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ senderId: userId, recipientId, text })
        });
        document.getElementById("msgInput").value = "";
      } catch (err) {
        console.error("Send failed", err);
      }
    });
  </script>